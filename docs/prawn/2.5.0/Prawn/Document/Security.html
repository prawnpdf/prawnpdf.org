<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Prawn::Document::Security
  
    &mdash; Prawn Documentation
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

  <link rel="stylesheet" href="../../css/syntax-highlight.css" type="text/css" />

<script type="text/javascript">
  pathId = "Prawn::Document::Security";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Prawn.html" title="Prawn (module)">Prawn</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Document.html" title="Prawn::Document (class)">Document</a></span></span>
     &raquo; 
    <span class="title">Security</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Prawn::Document::Security
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../Document.html" title="Prawn::Document (class)">Prawn::Document</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/prawn/security.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Implements PDF encryption (password protection and permissions) as
specified in the PDF Reference, version 1.3, section 3.5 “Encryption”.</p>


  </div>
</div>
<div class="tags">
  


</div>








  
    <section id="method-summary-z8oa18">
      <h2>
        Experimental API
        <small><a href="#" class="summary_toggle">collapse</a></small>
      </h2>

      <ul class="summary">
        
          <li class="public ">
  <span class="summary_signature">
    
      <a href="#encrypt_string-class_method" title="encrypt_string (class method)">.<strong>encrypt_string</strong>(str, key, id, gen)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Encrypts the given string under the given key, also requiring the object ID and generation number of the reference.</p>
</div></span>
  
</li>

        
          <li class="public ">
  <span class="summary_signature">
    
      <a href="#encrypt_document-instance_method" title="#encrypt_document (instance method)">#<strong>encrypt_document</strong>(options = {})  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Encrypts the document, to protect confidential data or control modifications to the document.</p>
</div></span>
  
</li>

        
      </ul>
    </section>
  




  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="encrypt_string-class_method">
  
    .<strong>encrypt_string</strong>(str, key, id, gen)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Encrypts the given string under the given key, also requiring the object
ID and generation number of the reference.</p>

<p>See Algorithm 3.1.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>gen</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
<details class="source-code">
  <summary><span>Source Code</span></summary>
  <div class="info file">lib/prawn/security.rb, line 106</div>
  <table class="highlight highlighter-rouge"><tbody><tr id="line-106" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>106</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">encrypt_string</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">gen</span><span class="p">)</span>
</pre></td></tr><tr id="line-107" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>107</pre></td><td class="rouge-code"><pre>  <span class="c1"># Convert ID and Gen number into little-endian truncated byte strings</span>
</pre></td></tr><tr id="line-108" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>108</pre></td><td class="rouge-code"><pre>  <span class="nb">id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">].</span><span class="nf">pack</span><span class="p">(</span><span class="s1">'V'</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></td></tr><tr id="line-109" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>109</pre></td><td class="rouge-code"><pre>  <span class="n">gen</span> <span class="o">=</span> <span class="p">[</span><span class="n">gen</span><span class="p">].</span><span class="nf">pack</span><span class="p">(</span><span class="s1">'V'</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></td></tr><tr id="line-110" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>110</pre></td><td class="rouge-code"><pre>  <span class="n">extended_key</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}#{</span><span class="nb">id</span><span class="si">}#{</span><span class="n">gen</span><span class="si">}</span><span class="s2">"</span>
</pre></td></tr><tr id="line-111" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>111</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-112" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>112</pre></td><td class="rouge-code"><pre>  <span class="c1"># Compute the RC4 key from the extended key and perform the encryption</span>
</pre></td></tr><tr id="line-113" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>113</pre></td><td class="rouge-code"><pre>  <span class="n">rc4_key</span> <span class="o">=</span> <span class="no">Digest</span><span class="o">::</span><span class="no">MD5</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="n">extended_key</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></td></tr><tr id="line-114" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>114</pre></td><td class="rouge-code"><pre>  <span class="no">Arcfour</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">rc4_key</span><span class="p">).</span><span class="nf">encrypt</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
</pre></td></tr><tr id="line-115" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>115</pre></td><td class="rouge-code"><pre><span class="k">end</span>
</pre></td></tr></tbody></table>
</details>

</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="encrypt_document-instance_method">
  
    #<strong>encrypt_document</strong>(options = {})  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Encrypts the document, to protect confidential data or control
modifications to the document. The encryption algorithm used is detailed
in the PDF Reference 1.3, section 3.5 “Encryption”, and it is
implemented by all major PDF readers.</p>

<h4 id="examples">Examples</h4>

<p>Deny printing to everyone, but allow anyone to open without a password:</p>

<div class="language-ruby highlighter-rouge"><pre><code><span class="n">encrypt_document</span> <span class="ss">permissions: </span><span class="p">{</span> <span class="ss">print_document: </span><span class="kp">false</span> <span class="p">},</span>
  <span class="ss">owner_password: :random</span>
</code></pre></div>

<p>Set a user and owner password on the document, with full permissions for
both the user and the owner:</p>

<div class="language-ruby highlighter-rouge"><pre><code><span class="n">encrypt_document</span> <span class="ss">user_password: </span><span class="s1">'foo'</span><span class="p">,</span> <span class="ss">owner_password: </span><span class="s1">'bar'</span>
</code></pre></div>

<p>Set no passwords, grant all permissions (This is useful because the
default in some readers, if no permissions are specified, is “deny”):</p>

<div class="language-ruby highlighter-rouge"><pre><code><span class="n">encrypt_document</span>
</code></pre></div>

<h4 id="caveats">Caveats</h4>

<ul>
  <li>The encryption used is weak; the key is password-derived and is
limited to 40 bits, due to US export controls in effect at the time
the PDF standard was written.</li>
  <li>There is nothing technologically requiring PDF readers to respect the
permissions embedded in a document. Many PDF readers do not.</li>
  <li>In short, you have <strong>no security at all</strong> against a moderately
motivated person. Don’t use this for anything super-serious. This is
not a limitation of Prawn, but is rather a built-in limitation of the
PDF format.</li>
</ul>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash{Symbol =&gt; any}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:user_password</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Password required to open the document. If this is omitted or empty,
no password will be required. The document will still be encrypted,
but anyone can read it.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:owner_password</span>
          <span class="type">(<tt>String</tt>, <tt>:random</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Password required to make modifications to the document or change or
override its permissions. If this is set to <code class="language-ruby highlighter-rouge"><span class="ss">:random</span></code>, a random
password will be used; this can be useful if you never want users to
be able to override the document permissions.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:permissions</span>
          <span class="type">(<tt>Hash{Symbol =&gt; Boolean}</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>A hash mapping permission symbols (see below) to <code class="language-ruby highlighter-rouge"><span class="kp">true</span></code> or <code class="language-ruby highlighter-rouge"><span class="kp">false</span></code>.
<code class="language-ruby highlighter-rouge"><span class="kp">true</span></code> means “permitted”, and <code class="language-ruby highlighter-rouge"><span class="kp">false</span></code> means “not permitted”. All
permissions default to <code class="language-ruby highlighter-rouge"><span class="kp">true</span></code>.</p>

<p>The following permissions can be specified:</p>

<ul>
  <li><code class="language-ruby highlighter-rouge"><span class="ss">:print_document</span></code> – Print document.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="ss">:modify_contents</span></code> – Modify contents of document (other than text
annotations and interactive form fields).</li>
  <li><code class="language-ruby highlighter-rouge"><span class="ss">:copy_contents</span></code> – Copy text and graphics from document.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="ss">:modify_annotations</span></code> – Add or modify text annotations and
interactive form fields.</li>
</ul>
</div>
          
        </li>
      
    </ul>
  


</div>
<details class="source-code">
  <summary><span>Source Code</span></summary>
  <div class="info file">lib/prawn/security.rb, line 78</div>
  <table class="highlight highlighter-rouge"><tbody><tr id="line-78" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>78</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">encrypt_document</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
</pre></td></tr><tr id="line-79" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>79</pre></td><td class="rouge-code"><pre>  <span class="no">Prawn</span><span class="p">.</span><span class="nf">verify_options</span><span class="p">(</span><span class="sx">%i[user_password owner_password permissions]</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</pre></td></tr><tr id="line-80" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>80</pre></td><td class="rouge-code"><pre>  <span class="vi">@user_password</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="ss">:user_password</span><span class="p">)</span> <span class="o">||</span> <span class="s1">''</span>
</pre></td></tr><tr id="line-81" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>81</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-82" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>82</pre></td><td class="rouge-code"><pre>  <span class="vi">@owner_password</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="ss">:owner_password</span><span class="p">)</span> <span class="o">||</span> <span class="vi">@user_password</span>
</pre></td></tr><tr id="line-83" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>83</pre></td><td class="rouge-code"><pre>  <span class="k">if</span> <span class="vi">@owner_password</span> <span class="o">==</span> <span class="ss">:random</span>
</pre></td></tr><tr id="line-84" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>84</pre></td><td class="rouge-code"><pre>    <span class="c1"># Generate a completely ridiculous password</span>
</pre></td></tr><tr id="line-85" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>85</pre></td><td class="rouge-code"><pre>    <span class="vi">@owner_password</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">32</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="p">}.</span><span class="nf">pack</span><span class="p">(</span><span class="s1">'c*'</span><span class="p">)</span>
</pre></td></tr><tr id="line-86" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>86</pre></td><td class="rouge-code"><pre>  <span class="k">end</span>
</pre></td></tr><tr id="line-87" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>87</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-88" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>88</pre></td><td class="rouge-code"><pre>  <span class="nb">self</span><span class="p">.</span><span class="nf">permissions</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="ss">:permissions</span><span class="p">)</span> <span class="o">||</span> <span class="p">{}</span>
</pre></td></tr><tr id="line-89" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>89</pre></td><td class="rouge-code"><pre>
</pre></td></tr><tr id="line-90" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>90</pre></td><td class="rouge-code"><pre>  <span class="c1"># Shove the necessary entries in the trailer and enable encryption.</span>
</pre></td></tr><tr id="line-91" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>91</pre></td><td class="rouge-code"><pre>  <span class="n">state</span><span class="p">.</span><span class="nf">trailer</span><span class="p">[</span><span class="ss">:Encrypt</span><span class="p">]</span> <span class="o">=</span> <span class="n">encryption_dictionary</span>
</pre></td></tr><tr id="line-92" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>92</pre></td><td class="rouge-code"><pre>  <span class="n">state</span><span class="p">.</span><span class="nf">encrypt</span> <span class="o">=</span> <span class="kp">true</span>
</pre></td></tr><tr id="line-93" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>93</pre></td><td class="rouge-code"><pre>  <span class="n">state</span><span class="p">.</span><span class="nf">encryption_key</span> <span class="o">=</span> <span class="n">user_encryption_key</span>
</pre></td></tr><tr id="line-94" class="lineno"><td class="rouge-gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>94</pre></td><td class="rouge-code"><pre><span class="k">end</span>
</pre></td></tr></tbody></table>
</details>

</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Mar  5 12:42:39 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.36 (ruby-3.3.0).
</div>

    </div>
  </body>
</html>